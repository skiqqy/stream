#!/bin/bash
# Written by skiqqy
# Usage: stream -h

args=( $@ ) # I want splitting
deps=( youtube-dl mpv ) # List of dependencies needed by stream
version=alpha-1.0v
socket=/tmp/mpvsoc
v=--no-video

usage ()
{
	cat << EOF
Stream $version ~ The simple stream utility

Usage: stream [options] [url]

options
-------

-h    Shows this message.

Written by skiqqy
EOF
	exit "$1"
}

# Play a stream
# Usage play "$url"
play ()
{
	mpv --ytdl-raw-options=force-ipv4= "$1" "$v" --input-ipc-server="$socket"
}

main ()
{
	opts="hs:dv"
	while getopts "$opts" opt
	do
		case "$opt" in
			h)
				usage 0
				;;
			s)
				socket="$OPTARG"
				;;
			d)
				echo "Dependencies: ${deps[*]}"
				exit 0
				;;
			v)
				echo "Enabling video"
				v=
				;;
			*)
				usage 1
				;;
		esac
	done

	echo "Stream instance ID: $$"
	play https://www.youtube.com/watch?v=5qap5aO4i9A # Just for now.
}

main "$@"
